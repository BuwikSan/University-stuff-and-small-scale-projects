{% extends "base.html" %}

{% block title %}Dashboard - KrizeMapa{% endblock %}

{% block content %}
<div class="dashboard">
    <h1>Dashboard</h1>
    <p class="subtitle">P≈ôehled aktu√°ln√≠ch krizov√Ωch situac√≠</p>

    <!-- Stats Cards -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-number">{{ total_events }}</div>
            <div class="stat-label">Celkem hl√°≈°en√Ωch kriz√≠</div>
        </div>
        <div class="stat-card critical">
            <div class="stat-number">{{ today_events }}</div>
            <div class="stat-label">Dnes hl√°≈°eno</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Status</div>
            <div class="status-badge online">‚úì Online</div>
        </div>
    </div>

    <!-- Latest Events -->
    <section class="section">
        <h2>Posledn√≠ hl√°≈°en√≠</h2>
        {% if latest_events %}
            <div class="events-list">
                {% for event in latest_events %}
                <div class="event-card severity-{{ event.severity }}">
                    <div class="event-header">
                        <h3>{{ event.title }}</h3>
                        <span class="severity-badge">Stupe≈à {{ event.severity }}/5</span>
                    </div>
                    <p class="event-type">{{ event.event_type }}</p>
                    <p class="event-location">{{ event.location }}</p>
                    <p class="event-time">{{ event.created_at.strftime('%d.%m.%Y %H:%M') }}</p>
                    <a href="{{ url_for('events.view_event', event_id=event._id) }}" class="link-more">V√≠ce detail≈Ø ‚Üí</a>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <p class="text-muted">≈Ω√°dn√© hl√°≈°en√© krize.</p>
        {% endif %}
    </section>

    <!-- Action Buttons -->
    <section class="section actions">
        <a href="{{ url_for('events.submit_event') }}" class="btn btn-primary btn-large">
            ‚ûï Hl√°sit novou krizi
        </a>
        <a href="{{ url_for('events.view_all') }}" class="btn btn-secondary btn-large">
            üìä Zobrazit v≈°echny krize
        </a>
    </section>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Refresh stats ka≈æd√Ωch 30 sekund
    async function refreshStats() {
        try {
            const response = await fetch('{{ url_for("events.api_stats") }}');
            const data = await response.json();
            console.log('Stats:', data);
            // Lze later updatovat UI dynamicky
        } catch (e) {
            console.error('Stats refresh error:', e);
        }
    }
    
    // Poƒç√°teƒçn√≠ refresh + interval
    setInterval(refreshStats, 30000);
</script>
{% endblock %}
