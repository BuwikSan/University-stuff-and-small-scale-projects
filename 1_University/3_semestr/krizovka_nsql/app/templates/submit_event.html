{% extends "base.html" %}

{% block title %}Hlásit krizi - KrizeMapa{% endblock %}

{% block content %}
<div class="form-container">
    <h1>Hlásit krizi</h1>
    <p class="subtitle">Prosím vyplň všechny detaily o krizové situaci</p>

    <form method="POST" action="{{ url_for('events.submit_event') }}" class="crisis-form">
        <!-- Název -->
        <div class="form-group">
            <label for="title">Název / Téma krize *</label>
            <input 
                type="text" 
                id="title" 
                name="title" 
                required 
                placeholder="Např. Požár v obchodním centru"
                maxlength="200"
            >
        </div>

        <!-- Popis -->
        <div class="form-group">
            <label for="description">Popis situace *</label>
            <textarea 
                id="description" 
                name="description" 
                required 
                placeholder="Detailní popis co se stalo, počet postižených, apod."
                rows="5"
                maxlength="2000"
            ></textarea>
            <small class="form-hint">Max. 2000 znaků</small>
        </div>

        <!-- Lokace -->
        <div class="form-group">
            <label for="location">Lokace / Adresa *</label>
            <input 
                type="text" 
                id="location" 
                name="location" 
                required 
                placeholder="Ulice, město, nebo zemská nebo GPS souřadnice"
            >
        </div>

        <!-- Typ krize -->
        <div class="form-group">
            <label for="type">Typ krize *</label>
            <select id="type" name="type" required>
                <option value="">-- Vyber typ --</option>
                {% for type_val in crisis_types %}
                <option value="{{ type_val }}">{{ type_val|replace('_', ' ')|title }}</option>
                {% endfor %}
            </select>
        </div>

        <!-- Stupeň závažnosti -->
        <div class="form-group">
            <label for="severity">Stupeň závažnosti *</label>
            
            <!-- Popisky nad posuvníkem -->
            <div class="severity-labels-top">
                <span>Zanedbatelná</span>
                <span>Nízká</span>
                <span>Střední</span>
                <span>Vysoká</span>
                <span>Kritická</span>
            </div>
            
            <!-- Posuvník -->
            <input 
                type="range" 
                id="severity" 
                name="severity" 
                min="1" 
                max="5" 
                value="1"
                class="slider"
                data-touched="false"
            >
            
            <!-- Zvolená severita pod posuvníkem -->
            <div class="severity-display">
                <p>Zvolená: <strong id="severity-value">Stupeň 3/5</strong></p>
            </div>
        </div>

        <!-- Submit -->
        <div class="form-actions">
            <button type="submit" class="btn btn-primary btn-large">
                Odeslat hlášení
            </button>
            <a href="{{ url_for('main.index') }}" class="btn btn-secondary">
                Zrušit
            </a>
        </div>
    </form>
</div>

{% endblock %}

{% block extra_js %}
<script>
    // Real-time severity label update
    const severitySlider = document.getElementById('severity');
    const severityValue = document.getElementById('severity-value');
    const labels = ['Zanedbatelná', 'Nízká', 'Střední', 'Vysoká', 'Kritická'];
    const crisisForm = document.querySelector('.crisis-form');
    
    // Init - display current value (which is 1)
    severityValue.textContent = 'Stupeň 1/5 - ' + labels[0];
    
    // Track any interaction with slider (click, drag, keyboard)
    severitySlider.addEventListener('input', function() {
        severityValue.textContent = 'Stupeň ' + this.value + '/5 - ' + labels[this.value - 1];
        severitySlider.setAttribute('data-touched', 'true');
        severitySlider.style.borderColor = 'transparent'; // Remove error border if exists
    });
    
    // Also track mousedown/touchstart for direct clicks
    severitySlider.addEventListener('mousedown', function() {
        severitySlider.setAttribute('data-touched', 'true');
    });
    
    severitySlider.addEventListener('touchstart', function() {
        severitySlider.setAttribute('data-touched', 'true');
    });
    
    // Form submission validation
    crisisForm.addEventListener('submit', function(e) {
        if (severitySlider.getAttribute('data-touched') === 'false') {
            e.preventDefault();
            severitySlider.style.borderColor = '#e74c3c';
            severitySlider.style.borderWidth = '2px';
            
            // Show alert
            const errorDiv = document.createElement('div');
            errorDiv.className = 'alert alert-error';
            errorDiv.textContent = '⚠️ Prosím, klikni na posuvník a zvol stupeň závažnosti!';
            crisisForm.insertBefore(errorDiv, crisisForm.firstChild);
            
            // Remove error after 5 seconds
            setTimeout(() => {
                errorDiv.remove();
                severitySlider.style.borderColor = 'transparent';
            }, 5000);
        }
    });
</script>
{% endblock %}
